-----------------------
READY-MADE DEPENDENCIES
-----------------------

For a first-time mingw install:

  Don't forget /etc/fstab, which is necessary to have gcc on the path.

Build dependencies from mingw:

  mingw-get install mingw32-libz
  mingw-get install mingw32-gmp
  mingw-get install mingw32-libpopt
  mingw-get install mingw32-pthreads-w32

  Do not install the msys-libxml2 package (this is broken).

Build dependencies with standalone installers:

  CMake
  Doxygen
  Python
  Wix
  Qt (needs >= 4.8.6)

Other helpful stuff from mingw:

  mingw-get install msys-wget
  mingw-get install msys-unzip
  mingw-get install msys-zip

Other helpful stuff with standalone installers:

  Graphviz

------------------------
HAND-ROLLED DEPENDENCIES
------------------------

To build boost (verified for v1.54.0):

  Download .zip (not .tar.gz)
  Unzip with -q (output is *very* slow and there is lots)
  Open cmd.exe (not mingw)

  set PATH=C:\MinGW\bin;%PATH%
  cd path\to\boost
  bootstrap.bat mingw
  b2 toolset=gcc --with-python --with-regex variant=release link=shared

  Open mingw

  cd path/to/boost
  mv boost /c/Boost/include/boost-1_54 (or whatever version)
  mv stage/lib/* /c/Boost/lib

To build pkgconfig (verified for v0.28):

  ./configure --prefix=/home/bab/software --with-internal-glib

To build cppunit (verified for v1.12.1):

  ./configure --prefix=/home/bab/software

To build source-highlight (verified for v3.1.7):

  Patch to change NO_ERROR to NO_RANGE_ERROR (see source-highlight.patch).
  ./configure --prefix=/home/bab/software --with-boost=/c/Boost

To build qdbm, which replaces tokyocabinet for MinGW (verified for v1.8.78):

  ./configure --prefix=/home/bab/software

To build libxml2:

  MinGW's msys-libxml2 (2.7.6) is broken, and libxml2 must be hand-rolled.
  ./configure --prefix=/home/bab/software --with-threads=win32

To build the python system library for shipping:

  cd /c/Python27/Lib
  zip -r path/to/python27.zip . -x distutils/\* -x \*.pyc
  Also copy python27.dll from /c/Windows/System32

To prepare the handbook:

  Build docs.zip from some other package (e.g., the Mac bundle),
  so that handbooks are stored as docs/en/regina{,-xml}.

---------------
BUILDING REGINA
---------------

To build regina:

  Apply the patches from regina-mingw.patch (in this directory).

  cmake -G 'MSYS Makefiles'
    -DCMAKE_INCLUDE_PATH=/mingw/include:/include:/c/Boost/include/boost-1_54
    -DCMAKE_LIBRARY_PATH=/mingw/lib:/lib:/c/Boost/lib
    -DCMAKE_INSTALL_PREFIX=/home/bab/software
    -DQT_QMAKE_EXECUTABLE=/c/Qt/4.8.6/bin/qmake
    -DREGINA_DOCS=path/to/docs.zip
    ..

To run the test suite:

  export PATH="$PATH":/home/bab/software/bin
  make test ARGS=-V

To run locally:

  Copy all necessary DLLs into software/bin.

----------------------
BUILDING THE INSTALLER
----------------------

To prepare WiX for use:
  If WiX is not on the path, add aliases to ~/.bashrc:
    alias candle='"/c/Program Files/WiX Toolset v3.7/bin/candle"'
    alias light='"/c/Program Files/WiX Toolset v3.7/bin/light"'

To generate unique IDs for the windows installer:
  Build UUIDgen (gcc UUIDgen.c -lole32 -o UUIDgen)

To help fill documentation entries in regina.wsx:
  ls -1 ~/foo/MinGW/msys/1.0/home/bab/software/share/regina/docs/en/regina |
    sed -e "s#^#                        <File Name='#"
        -e "s#\$#'/>#" 
    > /tmp/foo

To build the installer:
  candle Regina.wxs WixUI_Regina.wxs
  light -ext WixUIExtension -o 'Regina 4.96.msi' Regina.wixobj WixUI_Regina.wixobj

