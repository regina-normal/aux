-----------------------
READY-MADE DEPENDENCIES
-----------------------

Install MSYS2:

  Download the 32-bit installer from https://msys2.github.io/
  Follow instructions on that page to update the core packages

  General notes for how to use the package manager:

    pacman -Qe             # list installed packages with versions
    pacman -Syu            # full system update
    pacman -S foo bar baz  # install one or more packages
    pacman -Ss foo         # search for package whose name contains "foo"

Install basic utilities from MSYS2:

  pacman -S diffutils git man-db patch perl openssh tar unzip vim wget zip

  Edit ~/.bashrc to add the line:

    export PKG_CONFIG_PATH="$PKG_CONFIG_PATH":/home/bab/software/lib/pkgconfig

Install build dependencies from mingw-w64:

  pacman -S make libxslt texinfo
  pacman -S mingw-w64-i686-toolchain
  pacman -S mingw-w64-i686-boost
  pacman -S mingw-w64-i686-cmake
  pacman -S mingw-w64-i686-cppunit
  pacman -S mingw-w64-i686-doxygen
  pacman -S mingw-w64-i686-libxml2
  pacman -S mingw-w64-i686-popt

Install build dependencies with standalone installers:

  Qt5 (from qt-project.org)
  Graphviz (from graphviz.org)
  Wix (from wixtoolset.org) - may require .NET to be installed separately

Ensure the following are UNINSTALLED:

  Python2.7 (from python.org) - causes problems with MinGW's math.h

NOTE: To put gcc on the path, you need to run the mingw32 shell, not msys2.

------------------------
HAND-ROLLED DEPENDENCIES
------------------------

To build source-highlight (verified for v3.1.8):

  (download from gnu.org/software/src-highlite/)
  ./configure --prefix=/home/bab/software --with-boost-libdir=/mingw32/lib
  make ; make install

To build qdbm, which replaces tokyocabinet for MinGW (verified for v1.8.78):

  (download from fallabs.com/qdbm/)
  ./configure --prefix=/home/bab/software
  make ; make install

  (Note: tokyocabinet does not build because glob.h is missing.)

---------------
BUILDING REGINA
---------------

To build regina:

  Run regina-cmake.sh (in this directory) to get all necessary cmake arguments.
  make
  make install

To run the test suite (requires "make install" first):

  export PATH="$PATH":/home/bab/software/bin
  testsuite/regtestsuite.exe

  (Since switching to mingw's python, regina-python is not working at all...)

To run locally:

  Copy all necessary DLLs into software/bin.

  - Most DLLs come from /mingw32/bin/, and perhaps /bin/.

  - Some DLLs come from graphviz bin/:
      gvc cdt cgraph Pathplan gvplugin_core
      gvplugin_dot_layout gvplugin_neato_layout
      ltdl libexpat libglib-2.0-0

----------------------
BUILDING THE INSTALLER
----------------------

Package the python system library for shipping:

  cd /mingw32/lib/python2.7
  zip -r ~/python/python27.zip . -x distutils/\* -x \*.pyc -x \*.pyo

To prepare WiX for use:

  If WiX is not on the path, add aliases to ~/.bashrc:
    alias candle='"/c/Program Files/WiX Toolset v3.10/bin/candle"'
    alias light='"/c/Program Files/WiX Toolset v3.10/bin/light"'

Update the WiX source file:

  - Update the Regina version in Regina.wxs.template.

  - Check the list of files that Regina.wxs.template installs.

      * If more unique IDs are required (e.g., there are new * components),
        then run "uuidgen" (which comes with msys32) to generate them.

  - Run "make install" from the source tree, ensuring that ~/software is
    clean of any old Regina files.

  - Run "perl mkwxs.pl" to generate Regina.wxs.

Build the installer:

  candle Regina.wxs WixUI_Regina.wxs
  light -ext WixUIExtension -o 'Regina 5.0.msi' Regina.wixobj WixUI_Regina.wixobj

To package the installer as an ISO image for VirtualBox:

  - Put the .msi installer in a subdirectory Regina.

  - Using Disk Utility, create a new image from folder of type DVD/CD master.

  - Run: hdiutil makehybrid -iso -joliet -o <dest.iso> <source.cdr>

